        ORG 0
        B RESET
        
        ORG 0x18  ; ADRESA GDJE SE OCITAVA I ZAPSIUJE INFOMRAICJE TJ NAREDBA ZA OBICNA INTERRUPT, IRG
        B PAKET

RESET   ;INIT STACK POINTERE SP ZA SVE NACINE RADA:

        ;INIT ZA IRQ
        MSR CPSR,#0b11010010    ; PREBACUJEM GA U NACIN RADA IRQ
        MOV SP,#0x10000         ; INICIJALIZIRAM SP ZA NACIN RADA IRQ

        ;INIT ZA SVC
        MSR CPSR,#0b11010011    ; PREBACUJEM GA U NACIN RADA SUPERVISOR SVC
        MOV SP,#0xFC00         ; INICIJALIZIRAM SP ZA NACIN RADA SVC

        ;INIT ZA PREKIDE VANJSKE JEDINICE, U OVOM SLUCAJU TO JE SAMO RTC
        ;inicijaliazcija RTC-a:
        LDR R0,RTC      ; U R1 UCITAVAM ODRESU OD RTC-a
        MOV R1,#0
        STR R1,[R0,#12] ; U LOAD REGISTER LR SPREMAM VRIJENDOST 0
        STR R1,[R0,#8]  ; U STAT/EOI REGISTAR UPISUJEM VRIJEDNOST 0
        MOV R1,#20
        STR R1,[R0,#4]  ; U MR UPISUJEM VRIJENDOST 20
        MOV R1,#1
        STR R1,[R0,#16] ; U CR SPREMAM VRIJENDOST 1, OMOGUCUJEM PREKIDE KOD RTC JEDINICE

        ;OMOGUCAVANJE PREKIDA U PROGRAMU:
        MRS R1,CPSR
        BIC R1,R1,#0b11000000   ; MICEM ODGOVARAJUCE BITOVE U R1 KOJE SU SPRMEITI U CPSR I NA TAJ NAICN CU OMGUCINITI DA PROCESOR DETEKTIRA PRKEID EU CIJELOM SUSTAVU
        MSR CPSR,R1

        ;SKOK NA GLAVNI PROGRAM
        B MAIN

;GLAVNI PROGRAM, TRENUTNO SE SAMO VRTI ALI INACE BI IMAO I NESTO KORSINO
MAIN B MAIN
        
        

;PREKIDA RUTINA ZA IRQ ZA MJERENJE BROJA POKLONA
PAKET   STMFD SP!,{R0,R1}

        LDR R0,RTC
        MOV R1,#0
        STR R1,[R0,#12] ; POSTAVLJAM BROJAC NAZAD NA 0, TAKO DA UPISUJEM 0 U LR
        STR R1,[R0,#8]  ; BRISEM VRIJEDNOST U STAT/EOI REGISTRU TKAO DA UPISUJEM VRIJENDOT 0 NO MOGAO SMA UPISAITI I BILO KOJU DRUGU VRIJEDNOST
        
        LDR R0,BR_PAK
        ADD R0,R0,#1
        STR R0,BR_PAK
        
        LDMFD SP!,{R0,R1} ; VRACAM STAVRI IZ KONTEKSTA
        SUBS PC,LR,#4     ; VRACAM SE U GLAVNI PROGRAM      


RTC DW 0xFFFF0E00
BR_PAK DW 0
